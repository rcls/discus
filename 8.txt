registers

SS/RR registers:
A
W
X
Y

Buses
 - V operand / address
 - B mem read
 - mem write

V bus - complementary signalling, flip-flop driven, active LOW.
 (address decodes will have CMOS inverters to drive the fan-out...)
B bus - open drain
mem write - needs write strobe (clock phase 2).


source bus is register or constant.  Memory address is always source bus.
operand bus is source bus direct or memory lookup
result bus is ALU output, or operand bus direct (add 0...)

00XXXXXX - data prefix (load immediate register).
  * any other instruction clears data prefix.

00LCCCXX - with prefix, jump, opt link.
  [prob have space to use 01 & get RR...]

01AAAMRR - ins that r/w A. (flags Z C O?)
  * 7 basic operations:
     add(c) sub(c) or and xor
  * also possibly cmp or sta?
  * probably don't need sub...

100WWMRR - operand to reg WW.

+ could save space on inc/dec decode if we did ww=op +/- 1.
+ have space for it with compressed jumps...

101 : misc crap:

  111100RR : in - only need in(a).
  111110RR : out - only need out(a), but can use full bus....

  111001RR : sta

  111011xx :
  111101xx :
  111111xx :

Not necessary:
     setc
     clrc (if or/and/xor have both clear and set c).
     shr
     ror
     not
     neg



00 - prefix or jmp/call constant. (Inc. uncond.)
00LCCCxx - call(L=0) or jmp(L=1).
01AAAMRR - ops that r/w A.
100WWMRR - Load WW = src, no flags.
110WWMRR - WW = src+1, flag Z.
111WWMRR - WW = src-1, flag Z.

101xxxxx - special, no flags.
101CCC00 - ret.
101UUURR - sta, UUU is never cond. (but might as well be in normal ops...)

in/out : 101VVVRR, VVV is also never cond, make WW/RR magically match A...
No real constraints on reg numbers...

AAA = 000 : sbc
AAA = 001 : sub
AAA = 010 : adc
AAA = 011 : add
AAA = 100 : xor
AAA = 101 : or
AAA = 110 : cmp
AAA = 111 : and


CCC = 000 : always
CCC = 001 : never
CCC = 010 : never
CCC = 011 : never
CCC = 100 : c
CCC = 101 : nc
CCC = 110 : z
CCC = 111 : nz

101010xx - sta.

10101111 - out
10101100 - in


in/out is an ALU ins?


A : 00
X : 01
Y : 10
U : 11

01xxxxxx : write A
(100/11x)WWxxx : write WW.


slice to do:
v constant is always from latch, interface for that?

Out can just use V or B bus. (V->Out, In->B?)

constant latch 0,1 also can serve for reg write address latch.

Put the VR strobe into the read-select strobes (push-pull)?

Fixme - Z flag...


Decode signals...

AR#
AS
CS#
CR
[also CinS#, CinR...]XF
N
C-latch
VK
BV
AND
OR

O4# - Flag = 0
O3#, O4 - Flag = FZ#
O3, O4 - Flag = FC#

N - high only for SUB, SBC and CMP
OR - high only for OR
AND - high only for AND

C - high for AND, low for OR, XOR...

Cin - force high for AND, SUB, CMP, INC
 - force low for ADD, DEC, OR, XOR

straight though:
Either ADD, OR, XOR with A=0, [CR don't care for ADD].
Or AND with A=255.

BV - if B not coming from memory or I/O port.

Write reg:

 01xxxxxx except 01110xxx (cmp)
 1xxxxxxx except 101xxxxx
 also IN (some 101xxxxx).

[~7 & 6 & (~5 | ~4 | 3)]  |  [7 & (~6 | 5 | IN)]

C is written by 01xxxxxx
Z is written by everything that writes a reg, plus cmp
   except: move (100xxxxxx), in (some 101xxxxx).
   i.e. x1xxxxxx

Load mem (many don't care):

01xxx1xx
1xxxx1xx except some 111xx1xx

IN is a do care (we want the bus...)


FIXME - for IN we probably want no to disable carry chain...

AND is high for 01111xxx
is low for 1xxxxxxx
don't care 00xxxxxx
So take 0x111xxx

OR is high for 01101xxx
don't care 00xxxxxx
Take 0x101xxx

AS is high for dec, 111xxxxx
AR# is low for inc,mv, 1x0xxxxx : FIXME - on IN also.
AR# dominates, so AS high on 11xxxxxx is OK.



CS# - low for AND (anything else?), 0x111xxx
CR - high for OR, XOR, 0110xxxx don't care 00xxxxxx, take 0x10xxxx
[CR dominates, take CS# 0x1x1xxx.]

CinS# - low for AND, ADD, DEC, don't care for jumps...
 01011xxx, 01111xxx, 111xxxxx gives
 0xx11xxx, 111xxxxx
[Make CinS dominant...]

CinR - high for OR, XOR, SUB, CMP, INC : FIXME IN.
 01001xxx, 01101xxx, 01100xxx, 01001xxx, 01110xxx, 110xxxxx gives
 0xx01xxx, 0x1x0xxx, 110xxxxx
with dominance...
 0xxx1xxx, 0x1xxxxx, 11xxxxxx

N - assert for SUB, SBC, CMP

0x00xxxx
0x110xxx
